#+TITLE: Session Context
#+DATE: 2026-01-20

* Previous Session: Monday 2026-01-20

** Completed

*** Fixed hostid mismatch bug (commit 0524467)
- Root cause: ~hostid~ command returned value X, then ~zgenhostid~ created /etc/hostid with value Y
- Fix: Call ~zgenhostid~ FIRST in configure_bootloader(), then read consistent value
- Verified: GRUB and /etc/hostid match after installation

*** Added Avahi mDNS to installed systems (commit f62bf9b)
- Packages: avahi, nss-mdns added to pacstrap
- Service: avahi-daemon enabled
- Matches archsetup implementation
- Systems now accessible as <hostname>.local after install

*** Added Avahi validation to test scripts (commit 7b6c409)
- sanity-test.sh: Check avahi-daemon enabled and running
- test-install.sh: Verify packages and service on installed system

*** Fixed full-test.sh bug (commit a774bae)
- Bug: ((TESTS_PASSED++)) returns exit code 1 when starting at 0
- Fix: Use pre-increment ((++TESTS_PASSED))

** Test Results
- Sanity test: 15/15 passed
- Single-disk install: PASS
- Mirror install: PASS
- RAIDZ1 install: PASS

** ISO Distributed
- ~/Downloads/isos/
- truenas.local:/mnt/vault/isos/
- /dev/sda (ARCHZFS USB boot drive)
- /dev/sdb1 (Ventoy)

** Notes
- ratio needs reinstall with fixed ISO (or manual hostid fix)
