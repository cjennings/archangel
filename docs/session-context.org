#+TITLE: Session Context
#+DATE: 2026-01-20

* Current Session: Tuesday 2026-01-20 @ ~11:00 CST

** Status: REBUILDING ISO

Build in progress with the following fixes:
- Added /etc/hosts with archzfs hostname entries
- Added /etc/nsswitch.conf with mdns_minimal for mDNS resolution
- Added inetutils package (provides hostname command)
- Updated sanity test to use `cat /etc/hostname` instead of `hostname`

** Changes Made This Session (ALL UNCOMMITTED)

*** build.sh
- Added safe_cleanup_work_dir() function and trap (from interrupted session)
- Fixed shadow file handling (sed instead of replace)
- Added /etc/hosts file creation
- Added nsswitch.conf configuration for nss-mdns
- Added inetutils to package list

*** scripts/sanity-test.sh
- Added test: "Root password is set"
- Added test: "Avahi package installed"
- Added test: "nss-mdns configured"
- Added test: "Hostname is archzfs"
- Changed hostname test to use `cat /etc/hostname`

*** ~/code/archsetup/inbox/console-display-issues.txt (NEW FILE)
Documented 5 potential console issues from earlier investigation.

** After Build Completes

1. Write ISO to USB drives (/dev/sda and /dev/sdb)
2. Wait for Craig's confirmation before testing on ratio
3. Commit changes after successful test

** Commit Message (After Testing Succeeds)

#+begin_src bash
git add -A
git commit -m "Fix mDNS, hostname, and build safety

- Add safe_cleanup_work_dir() to prevent /dev corruption on interrupted builds
- Fix shadow file: use sed to modify root entry instead of replacing file
- Add /etc/hosts and /etc/nsswitch.conf for proper hostname/mDNS
- Add inetutils package for hostname command
- Add sanity tests for password, avahi, mdns, and hostname"
#+end_src
